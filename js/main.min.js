function respondCanvas(){var e=document.getElementById("balls_canvas"),t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);e.setAttribute("width",document.documentElement.offsetWidth),e.setAttribute("height",t-7)}function initCanvas(){function o(e){e.conteiner?(e.centerX+e.radius>t&&(e.ball_move?e.speedX=0:(i=.7*-i,i*=.99),e.centerX=t-e.radius),e.centerX-e.radius<0&&(e.ball_move?e.speedX=0:(e.speedX=.7*-e.speedX,e.speedY*=.99),e.speedX=0),e.centerY+e.radius>s&&(e.ball_move?e.speedY=0:(e.speedX*=.99,e.speedY=.7*-e.speedY),e.centerY=s-e.radius),e.centerY<0&&(e.ball_move?e.speedY=0:(e.speedX*=.99,e.speedY=.7*-e.speedY),e.speedY=0),e.ball_move&&(e.speedX=(a-e.centerX)/2,e.speedY=(r-e.centerY)/2),e.speedY+=.9,e.speedX*=.99,e.speedY*=.99,e.centerX+=e.speedX,e.centerY+=e.speedY):(e.centerX-e.radius<=0&&(e.centerX=e.radius,e.speedX*=-1),e.centerX+e.radius>=t&&(e.centerX=t-e.radius,e.speedX*=-1),e.centerY-e.radius<=s&&(e.centerY=e.radius+s,e.speedY*=-1),e.centerY+e.radius>=n&&(e.centerY=n-e.radius,e.speedY*=-1),e.ball_move&&(e.speedX=(a-e.centerX)/2,e.speedY=(r-e.centerY)/2),e.centerX+=e.speedX,e.centerY+=e.speedY)}function l(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++){var s=e[t],a=e[n],r=Math.pow(s.centerX-a.centerX,2)+Math.pow(s.centerY-a.centerY,2);s.radius+a.radius>=Math.sqrt(r)&&f(e[t],e[n])}}function f(e,t){var n=t.centerX-e.centerX,s=t.centerY-e.centerY,a=Math.atan2(s,n),r=Math.sin(a),i=Math.cos(a),d=0,c=0,o=e.speedX*i+e.speedY*r,l=e.speedY*i-e.speedX*r,f=n*i+s*r,u=s*i-n*r,p=t.speedX*i+t.speedY*r,v=t.speedY*i-t.speedX*r,Y=o-p;o=((e.weight-t.weight)*o+2*t.weight*p)/(e.weight+t.weight),p=o+Y;var h=Math.abs(o)+Math.abs(p),X=e.radius+t.radius-Math.abs(d-f);d+=o/h*X,f+=p/h*X,e.speedX=e.speedX+d*i-c*r,e.speedY=e.speedY+c*i+d*r,t.speedX=e.speedX+f*i-u*r,t.speedY=e.speedY+u*i+f*r,e.speedX=o*i-l*r,e.speedY=l*i+o*r,t.speedX=p*i-v*r,t.speedY=v*i+p*r}function u(){var e={id:+Date.now().toString().slice(-4),centerX:90,centerY:-130,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"#"+Date.now().toString().slice(-6),speedX:0,speedY:0,weight:1,ball_move:!1,conteiner:!0},t=[];p.forEach(function(e){e.conteiner&&(t.push(e.id),t.length>6&&(p.shift(t[0]),t.shift()))}),0==t.length&&p.push(e)}function v(){Y=null,sessionStorage.removeItem("balls"),sessionStorage.balls=JSON.stringify(p)}function Y(){requestAnimationFrame(Y);e.clearRect(0,0,t,n),p.forEach(function(n){e.beginPath(),n.ball_move?(e.arc(a,r,n.radius,n.start_angle,n.end_angle,n.clockwise),r-n.radius>=s?(n.speedX=i,n.speedY=d,n.conteiner=!1):(n.speedX=0,n.speedY=0,n.conteiner=!0)):e.arc(n.centerX,n.centerY,n.radius,n.start_angle,n.end_angle,n.clockwise),e.fillStyle=n.color,e.fill(),e.lineWidth=1,e.strokeStyle="#111",e.stroke(),e.beginPath(),e.lineTo(0,s),e.lineTo(t,s),e.stroke(),l(p),o(n),u()})}var e=document.getElementById("balls_canvas").getContext("2d"),t=e.canvas.width,n=e.canvas.height,s=100,a=0,r=0,i=0,d=0,c="",p=sessionStorage.balls?JSON.parse(sessionStorage.balls):[{id:0,centerX:30,centerY:-30,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"magenta",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:1,centerX:60,centerY:-60,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"green",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:2,centerX:150,centerY:-110,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"orange",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:3,centerX:190,centerY:-150,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"dodgerblue",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:4,centerX:318,centerY:-240,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"crimson",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0}];Y(),e.canvas.addEventListener("mousedown",function(t){a=t.clientX-e.canvas.offsetLeft,r=t.clientY-e.canvas.offsetTop,p.forEach(function(e){a>=e.centerX-e.radius&&a<e.centerX+e.radius&&r>=e.centerY-e.radius&&r<e.centerY+e.radius&&(c=e.id,e.ball_move=!0,console.log(e+" "+e.id))})}),e.canvas.addEventListener("mousemove",function(t){t.preventDefault(),"number"==typeof c&&(a=t.clientX-e.canvas.offsetLeft,r=t.clientY-e.canvas.offsetTop)}),e.canvas.addEventListener("touchmove",function(t){t.preventDefault(),"number"==typeof c&&(a=t.changedTouches[0].clientX-e.canvas.offsetLeft,r=t.changedTouches[0].clientY-e.canvas.offsetTop)}),e.canvas.addEventListener("mouseup",function(e){e.preventDefault(),"number"==typeof c&&p.forEach(function(e){e.id===c&&(e.centerX=a,e.centerY=r,e.ball_move=!1,c=void 0)})}),e.canvas.addEventListener("touchend",function(e){e.preventDefault(),"number"==typeof c&&p.forEach(function(e){e.id===c&&(e.centerX=a,e.centerY=r,e.ball_move=!1,c=void 0)})}),window.addEventListener("beforeunload",v,!1),window.addEventListener("resize",function(){v(),location.reload()})}window.addEventListener("load",function(){respondCanvas(),initCanvas()});