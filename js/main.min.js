function respondCanvas(){var e=document.getElementById("balls_canvas"),t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);e.setAttribute("width",document.documentElement.offsetWidth),e.setAttribute("height",t-7)}function initCanvas(){function l(e){e.conteiner?(e.centerX+e.radius>t&&(e.ball_move?e.speedX=0:(d=.7*-d,d*=.99),e.centerX=t-e.radius),e.centerX-e.radius<0&&(e.ball_move?e.speedX=0:(e.speedX=.7*-e.speedX,e.speedY*=.99),e.speedX=0),e.centerY+e.radius>s&&(e.ball_move?e.speedY=0:(e.speedX*=.99,e.speedY=.7*-e.speedY),e.centerY=s-e.radius),e.centerY<0&&(e.ball_move?e.speedY=0:(e.speedX*=.99,e.speedY=.7*-e.speedY),e.speedY=0),e.ball_move&&(e.speedX=(i-e.centerX)/2,e.speedY=(r-e.centerY)/2),e.speedY+=.9,e.speedX*=.99,e.speedY*=.99,e.centerX+=e.speedX,e.centerY+=e.speedY):(e.centerX-e.radius<=0&&(e.centerX=e.radius,e.speedX*=-1),e.centerX+e.radius>=t&&(e.centerX=t-e.radius,e.speedX*=-1),e.centerY-e.radius<=s&&(e.centerY=e.radius+s,e.speedY*=-1),e.centerY+e.radius>=n&&(e.centerY=n-e.radius,e.speedY*=-1),e.ball_move&&(e.speedX=(i-e.centerX)/2,e.speedY=(r-e.centerY)/2),e.centerX+=e.speedX,e.centerY+=e.speedY)}function f(e){for(var t=0;t<e.length;t++)for(var n=t+1;n<e.length;n++){var s=e[t],a=e[n],i=Math.pow(s.centerX-a.centerX,2)+Math.pow(s.centerY-a.centerY,2);s.radius+a.radius>=Math.sqrt(i)&&u(e[t],e[n])}}function u(e,t){var n=t.centerX-e.centerX,s=t.centerY-e.centerY,a=Math.atan2(s,n),i=Math.sin(a),r=Math.cos(a),d=0,c=0,o=e.speedX*r+e.speedY*i,l=e.speedY*r-e.speedX*i,f=n*r+s*i,u=s*r-n*i,p=t.speedX*r+t.speedY*i,v=t.speedY*r-t.speedX*i,h=o-p;o=((e.weight-t.weight)*o+2*t.weight*p)/(e.weight+t.weight),p=o+h;var Y=Math.abs(o)+Math.abs(p),X=e.radius+t.radius-Math.abs(d-f);d+=o/Y*X,f+=p/Y*X,e.speedX=e.speedX+d*r-c*i,e.speedY=e.speedY+c*r+d*i,t.speedX=e.speedX+f*r-u*i,t.speedY=e.speedY+u*r+f*i,e.speedX=o*r-l*i,e.speedY=l*r+o*i,t.speedX=p*r-v*i,t.speedY=v*r+p*i}function p(){var e={id:+Date.now().toString().slice(-4),centerX:90,centerY:-130,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"#"+Date.now().toString().slice(-6),speedX:0,speedY:0,weight:1,ball_move:!1,conteiner:!0},t=[];v.forEach(function(e){e.conteiner&&(t.push(e.id),t.length>6&&(v.shift(t[0]),t.shift()))}),0==t.length&&v.push(e)}function h(){Y=null,sessionStorage.removeItem("balls"),sessionStorage.balls=JSON.stringify(v)}function Y(){requestAnimationFrame(Y);e.clearRect(0,0,t,n),e.drawImage(a,0,s,t,n),v.forEach(function(n){e.beginPath(),n.ball_move?(e.arc(i,r,n.radius,n.start_angle,n.end_angle,n.clockwise),r-n.radius>=s?(n.speedX=d,n.speedY=c,n.conteiner=!1):(n.speedX=0,n.speedY=0,n.conteiner=!0)):e.arc(n.centerX,n.centerY,n.radius,n.start_angle,n.end_angle,n.clockwise),e.fillStyle=n.color,e.fill(),e.lineWidth=1,e.strokeStyle="#111",e.stroke(),e.beginPath(),e.lineTo(0,s),e.lineTo(t,s),e.stroke(),f(v),l(n),p()})}var e=document.getElementById("balls_canvas").getContext("2d"),t=e.canvas.width,n=e.canvas.height,s=100,a=new Image;a.src="img/m&m.jpg";var i=0,r=0,d=0,c=0,o="",v=sessionStorage.balls?JSON.parse(sessionStorage.balls):[{id:0,centerX:30,centerY:-30,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"magenta",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:1,centerX:60,centerY:-60,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"green",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:2,centerX:150,centerY:-110,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"orange",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:3,centerX:190,centerY:-150,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"dodgerblue",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0},{id:4,centerX:318,centerY:-240,radius:20,start_angle:0,end_angle:2*Math.PI,clockwise:!1,color:"crimson",speedX:0,speedY:0,weight:2,ball_move:!1,conteiner:!0}];Y(),e.canvas.addEventListener("mousedown",function(t){i=t.clientX-e.canvas.offsetLeft,r=t.clientY-e.canvas.offsetTop,v.forEach(function(e){i>=e.centerX-e.radius&&i<e.centerX+e.radius&&r>=e.centerY-e.radius&&r<e.centerY+e.radius&&(o=e.id,e.ball_move=!0,console.log(e+" "+e.id))})}),e.canvas.addEventListener("mousemove",function(t){t.preventDefault(),"number"==typeof o&&(i=t.clientX-e.canvas.offsetLeft,r=t.clientY-e.canvas.offsetTop)}),e.canvas.addEventListener("touchmove",function(t){t.preventDefault(),"number"==typeof o&&(i=t.changedTouches[0].clientX-e.canvas.offsetLeft,r=t.changedTouches[0].clientY-e.canvas.offsetTop)}),e.canvas.addEventListener("mouseup",function(e){e.preventDefault(),"number"==typeof o&&v.forEach(function(e){e.id===o&&(e.centerX=i,e.centerY=r,e.ball_move=!1,o=void 0)})}),e.canvas.addEventListener("touchend",function(e){e.preventDefault(),"number"==typeof o&&v.forEach(function(e){e.id===o&&(e.centerX=i,e.centerY=r,e.ball_move=!1,o=void 0)})}),window.addEventListener("beforeunload",h,!1),window.addEventListener("resize",function(){h(),location.reload()})}window.requestAnimationFrame||(window.requestAnimationFrame=webkitRequestAnimationFrame||mozRequestAnimationFrame||function(e){return window.setTimeout(e,100/60)}),window.addEventListener("load",function(){respondCanvas(),initCanvas()});